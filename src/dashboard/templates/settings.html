{% extends "base.html" %}
{% block title %}WIDS Dashboard Settings{% endblock %}

{% block sidebar_controls %}
{# No specific controls needed #}
{% endblock %}

{% block content %}
<section id="settingsSection" class="dashboard-section active">
    <div class="page-header">
        <h1 class="h2">Settings</h1>
    </div>
    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="card">
                <div class="card-header"><i class="bi bi-gear-wide-connected me-2"></i>Application Configuration</div>
                <div class="card-body">
                    <p class="text-muted small mb-4"> Read-only settings loaded at server start. </p>
                    <dl class="row gy-3">
                        <dt class="col-sm-5">Target WIDS API URL</dt>
                        <dd class="col-sm-7"> <input type="text" readonly
                                class="form-control-plaintext form-control-sm font-monospace small"
                                value="{{ settings.WIDS_API_BASE_URL }}"> <small class="d-block text-muted">(Set via
                                <code>WIDS_API_BASE_URL</code> env var)</small> </dd>
                        <dt class="col-sm-5">Auth Token Expiry</dt>
                        <dd class="col-sm-7"> <input type="text" readonly
                                class="form-control-plaintext form-control-sm small"
                                value="{{ settings.AUTH_ACCESS_TOKEN_EXPIRE_MINUTES }} minutes"> <small
                                class="d-block text-muted">(Set via <code>DASHBOARD_AUTH...</code> env var)</small>
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="col-lg-5 mb-4">
            <div class="card">
                <div class="card-header"><i class="bi bi-person-check me-2"></i>User Preferences (Browser)</div>
                <div class="card-body">
                    <p class="text-muted small mb-4"> Settings stored in your browser. </p>
                    <form id="preferencesForm">
                        <div class="mb-3"> <label class="form-label small">Default Events Filter</label>
                            <div class="form-check form-switch"> <input class="form-check-input" type="checkbox"
                                    role="switch" id="prefUnlabeledOnly"> <label class="form-check-label"
                                    for="prefUnlabeledOnly">Show Only Unlabeled Events</label> </div>
                        </div>
                        <div class="mb-3"> <label for="prefEventsPerPage" class="form-label small">Default Events Per
                                Page</label> <select id="prefEventsPerPage" class="form-select form-select-sm">
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="250">250</option>
                                <option value="500">500</option>
                            </select> </div>
                        <div id="prefsSaveStatus" class="mt-3 small"></div>
                        <button type="submit" class="btn btn-success btn-sm"><i class="bi bi-check-lg me-1"></i>Save
                            Preferences</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="card bg-dark border-secondary">
                <div class="card-body">
                    <h5 class="card-title text-info"><i class="bi bi-info-circle-fill me-2"></i>Changing App Config</h5>
                    <p class="small text-muted">To modify critical settings like the API URL:</p>
                    <ol class="small text-muted">
                        <li>Stop dashboard server.</li>
                        <li>Set environment variable (e.g., <code>export WIDS_API_BASE_URL="..."</code>).</li>
                        <li>Restart dashboard server.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    // DOM Elements, Prefs Key, Load/Save Functions (Same as before)
    const prefsForm = document.getElementById('preferencesForm'); const prefUnlabeled = document.getElementById('prefUnlabeledOnly'); const prefLimit = document.getElementById('prefEventsPerPage'); const prefsSaveStatus = document.getElementById('prefsSaveStatus'); const PREFS_KEY = 'widsDashboardPrefs_v3'; // Updated key maybe
    function loadPreferences() { const p = getPreferences(); if (prefUnlabeled) prefUnlabeled.checked = p.unlabeledOnly; if (prefLimit) prefLimit.value = p.limit; }
    function savePreferences(event) { event.preventDefault(); try { const prefs = { unlabeledOnly: prefUnlabeled?.checked ?? true, limit: prefLimit?.value ?? "100" }; localStorage.setItem(PREFS_KEY, JSON.stringify(prefs)); if (prefsSaveStatus) { prefsSaveStatus.textContent = 'Preferences saved!'; prefsSaveStatus.className = 'mt-3 small text-success'; setTimeout(() => prefsSaveStatus.textContent = '', 3000); } } catch (e) { if (prefsSaveStatus) { prefsSaveStatus.textContent = 'Error saving prefs.'; prefsSaveStatus.className = 'mt-3 small text-danger'; } } }
    prefsForm?.addEventListener('submit', savePreferences);
    document.addEventListener('DOMContentLoaded', loadPreferences);
    // Refresh function for this page
    function refreshPageData() { console.log("Settings page refreshed."); /* No data fetch */ }
</script>
{% endblock %}